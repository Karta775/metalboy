use super::cpu::Cpu;
use log::{debug, warn};

// Format string representation
fn to_string(opcode: u8, mnemonic: &str, len: u8, cyc: &str, grp: &str) -> String {
    format!("| {:02X} - {:<6} | LEN: {} | CYC: {:<8} | GRP: {:<12} |", opcode, mnemonic, len, cyc, grp)
}

// Unknown opcode
fn unknown(cpu: &Cpu) -> String {
    format!("| {:02X} - {} | Unknown opcode |", cpu.opcode, "???")
}

// Log the decoded opcode appropriately
pub fn log_decode(cpu: &Cpu) {
    if let Some(decoded) = decode(cpu) {
        debug!("{}", decoded);
    } else {
        warn!("{}", unknown(cpu));
    }
}

// Match the opcode and return a formatted String, else return None
pub fn decode(cpu: &Cpu) -> Option<String> {
    match cpu.opcode {
        0x00 => Some(to_string(0x00, "NOP", 1, "[4]", "control/misc")),
        0x01 => Some(to_string(0x01, "LD", 3, "[12]", "x16/lsm")),
        0x02 => Some(to_string(0x02, "LD", 1, "[8]", "x8/lsm")),
        0x03 => Some(to_string(0x03, "INC", 1, "[8]", "x16/alu")),
        0x04 => Some(to_string(0x04, "INC", 1, "[4]", "x8/alu")),
        0x05 => Some(to_string(0x05, "DEC", 1, "[4]", "x8/alu")),
        0x06 => Some(to_string(0x06, "LD", 2, "[8]", "x8/lsm")),
        0x07 => Some(to_string(0x07, "RLCA", 1, "[4]", "x8/rsb")),
        0x08 => Some(to_string(0x08, "LD", 3, "[20]", "x16/lsm")),
        0x09 => Some(to_string(0x09, "ADD", 1, "[8]", "x16/alu")),
        0x0a => Some(to_string(0x0a, "LD", 1, "[8]", "x8/lsm")),
        0x0b => Some(to_string(0x0b, "DEC", 1, "[8]", "x16/alu")),
        0x0c => Some(to_string(0x0c, "INC", 1, "[4]", "x8/alu")),
        0x0d => Some(to_string(0x0d, "DEC", 1, "[4]", "x8/alu")),
        0x0e => Some(to_string(0x0e, "LD", 2, "[8]", "x8/lsm")),
        0x0f => Some(to_string(0x0f, "RRCA", 1, "[4]", "x8/rsb")),
        0x10 => Some(to_string(0x10, "STOP", 1, "[4]", "control/misc")),
        0x11 => Some(to_string(0x11, "LD", 3, "[12]", "x16/lsm")),
        0x12 => Some(to_string(0x12, "LD", 1, "[8]", "x8/lsm")),
        0x13 => Some(to_string(0x13, "INC", 1, "[8]", "x16/alu")),
        0x14 => Some(to_string(0x14, "INC", 1, "[4]", "x8/alu")),
        0x15 => Some(to_string(0x15, "DEC", 1, "[4]", "x8/alu")),
        0x16 => Some(to_string(0x16, "LD", 2, "[8]", "x8/lsm")),
        0x17 => Some(to_string(0x17, "RLA", 1, "[4]", "x8/rsb")),
        0x18 => Some(to_string(0x18, "JR", 2, "[12]", "control/br")),
        0x19 => Some(to_string(0x19, "ADD", 1, "[8]", "x16/alu")),
        0x1a => Some(to_string(0x1a, "LD", 1, "[8]", "x8/lsm")),
        0x1b => Some(to_string(0x1b, "DEC", 1, "[8]", "x16/alu")),
        0x1c => Some(to_string(0x1c, "INC", 1, "[4]", "x8/alu")),
        0x1d => Some(to_string(0x1d, "DEC", 1, "[4]", "x8/alu")),
        0x1e => Some(to_string(0x1e, "LD", 2, "[8]", "x8/lsm")),
        0x1f => Some(to_string(0x1f, "RRA", 1, "[4]", "x8/rsb")),
        0x20 => Some(to_string(0x20, "JR", 2, "[12, 8]", "control/br")),
        0x21 => Some(to_string(0x21, "LD", 3, "[12]", "x16/lsm")),
        0x22 => Some(to_string(0x22, "LD", 1, "[8]", "x8/lsm")),
        0x23 => Some(to_string(0x23, "INC", 1, "[8]", "x16/alu")),
        0x24 => Some(to_string(0x24, "INC", 1, "[4]", "x8/alu")),
        0x25 => Some(to_string(0x25, "DEC", 1, "[4]", "x8/alu")),
        0x26 => Some(to_string(0x26, "LD", 2, "[8]", "x8/lsm")),
        0x27 => Some(to_string(0x27, "DAA", 1, "[4]", "x8/alu")),
        0x28 => Some(to_string(0x28, "JR", 2, "[12, 8]", "control/br")),
        0x29 => Some(to_string(0x29, "ADD", 1, "[8]", "x16/alu")),
        0x2a => Some(to_string(0x2a, "LD", 1, "[8]", "x8/lsm")),
        0x2b => Some(to_string(0x2b, "DEC", 1, "[8]", "x16/alu")),
        0x2c => Some(to_string(0x2c, "INC", 1, "[4]", "x8/alu")),
        0x2d => Some(to_string(0x2d, "DEC", 1, "[4]", "x8/alu")),
        0x2e => Some(to_string(0x2e, "LD", 2, "[8]", "x8/lsm")),
        0x2f => Some(to_string(0x2f, "CPL", 1, "[4]", "x8/alu")),
        0x30 => Some(to_string(0x30, "JR", 2, "[12, 8]", "control/br")),
        0x31 => Some(to_string(0x31, "LD", 3, "[12]", "x16/lsm")),
        0x32 => Some(to_string(0x32, "LD", 1, "[8]", "x8/lsm")),
        0x33 => Some(to_string(0x33, "INC", 1, "[8]", "x16/alu")),
        0x34 => Some(to_string(0x34, "INC", 1, "[12]", "x8/alu")),
        0x35 => Some(to_string(0x35, "DEC", 1, "[12]", "x8/alu")),
        0x36 => Some(to_string(0x36, "LD", 2, "[12]", "x8/lsm")),
        0x37 => Some(to_string(0x37, "SCF", 1, "[4]", "x8/alu")),
        0x38 => Some(to_string(0x38, "JR", 2, "[12, 8]", "control/br")),
        0x39 => Some(to_string(0x39, "ADD", 1, "[8]", "x16/alu")),
        0x3a => Some(to_string(0x3a, "LD", 1, "[8]", "x8/lsm")),
        0x3b => Some(to_string(0x3b, "DEC", 1, "[8]", "x16/alu")),
        0x3c => Some(to_string(0x3c, "INC", 1, "[4]", "x8/alu")),
        0x3d => Some(to_string(0x3d, "DEC", 1, "[4]", "x8/alu")),
        0x3e => Some(to_string(0x3e, "LD", 2, "[8]", "x8/lsm")),
        0x3f => Some(to_string(0x3f, "CCF", 1, "[4]", "x8/alu")),
        0x40 => Some(to_string(0x40, "LD", 1, "[4]", "x8/lsm")),
        0x41 => Some(to_string(0x41, "LD", 1, "[4]", "x8/lsm")),
        0x42 => Some(to_string(0x42, "LD", 1, "[4]", "x8/lsm")),
        0x43 => Some(to_string(0x43, "LD", 1, "[4]", "x8/lsm")),
        0x44 => Some(to_string(0x44, "LD", 1, "[4]", "x8/lsm")),
        0x45 => Some(to_string(0x45, "LD", 1, "[4]", "x8/lsm")),
        0x46 => Some(to_string(0x46, "LD", 1, "[8]", "x8/lsm")),
        0x47 => Some(to_string(0x47, "LD", 1, "[4]", "x8/lsm")),
        0x48 => Some(to_string(0x48, "LD", 1, "[4]", "x8/lsm")),
        0x49 => Some(to_string(0x49, "LD", 1, "[4]", "x8/lsm")),
        0x4a => Some(to_string(0x4a, "LD", 1, "[4]", "x8/lsm")),
        0x4b => Some(to_string(0x4b, "LD", 1, "[4]", "x8/lsm")),
        0x4c => Some(to_string(0x4c, "LD", 1, "[4]", "x8/lsm")),
        0x4d => Some(to_string(0x4d, "LD", 1, "[4]", "x8/lsm")),
        0x4e => Some(to_string(0x4e, "LD", 1, "[8]", "x8/lsm")),
        0x4f => Some(to_string(0x4f, "LD", 1, "[4]", "x8/lsm")),
        0x50 => Some(to_string(0x50, "LD", 1, "[4]", "x8/lsm")),
        0x51 => Some(to_string(0x51, "LD", 1, "[4]", "x8/lsm")),
        0x52 => Some(to_string(0x52, "LD", 1, "[4]", "x8/lsm")),
        0x53 => Some(to_string(0x53, "LD", 1, "[4]", "x8/lsm")),
        0x54 => Some(to_string(0x54, "LD", 1, "[4]", "x8/lsm")),
        0x55 => Some(to_string(0x55, "LD", 1, "[4]", "x8/lsm")),
        0x56 => Some(to_string(0x56, "LD", 1, "[8]", "x8/lsm")),
        0x57 => Some(to_string(0x57, "LD", 1, "[4]", "x8/lsm")),
        0x58 => Some(to_string(0x58, "LD", 1, "[4]", "x8/lsm")),
        0x59 => Some(to_string(0x59, "LD", 1, "[4]", "x8/lsm")),
        0x5a => Some(to_string(0x5a, "LD", 1, "[4]", "x8/lsm")),
        0x5b => Some(to_string(0x5b, "LD", 1, "[4]", "x8/lsm")),
        0x5c => Some(to_string(0x5c, "LD", 1, "[4]", "x8/lsm")),
        0x5d => Some(to_string(0x5d, "LD", 1, "[4]", "x8/lsm")),
        0x5e => Some(to_string(0x5e, "LD", 1, "[8]", "x8/lsm")),
        0x5f => Some(to_string(0x5f, "LD", 1, "[4]", "x8/lsm")),
        0x60 => Some(to_string(0x60, "LD", 1, "[4]", "x8/lsm")),
        0x61 => Some(to_string(0x61, "LD", 1, "[4]", "x8/lsm")),
        0x62 => Some(to_string(0x62, "LD", 1, "[4]", "x8/lsm")),
        0x63 => Some(to_string(0x63, "LD", 1, "[4]", "x8/lsm")),
        0x64 => Some(to_string(0x64, "LD", 1, "[4]", "x8/lsm")),
        0x65 => Some(to_string(0x65, "LD", 1, "[4]", "x8/lsm")),
        0x66 => Some(to_string(0x66, "LD", 1, "[8]", "x8/lsm")),
        0x67 => Some(to_string(0x67, "LD", 1, "[4]", "x8/lsm")),
        0x68 => Some(to_string(0x68, "LD", 1, "[4]", "x8/lsm")),
        0x69 => Some(to_string(0x69, "LD", 1, "[4]", "x8/lsm")),
        0x6a => Some(to_string(0x6a, "LD", 1, "[4]", "x8/lsm")),
        0x6b => Some(to_string(0x6b, "LD", 1, "[4]", "x8/lsm")),
        0x6c => Some(to_string(0x6c, "LD", 1, "[4]", "x8/lsm")),
        0x6d => Some(to_string(0x6d, "LD", 1, "[4]", "x8/lsm")),
        0x6e => Some(to_string(0x6e, "LD", 1, "[8]", "x8/lsm")),
        0x6f => Some(to_string(0x6f, "LD", 1, "[4]", "x8/lsm")),
        0x70 => Some(to_string(0x70, "LD", 1, "[8]", "x8/lsm")),
        0x71 => Some(to_string(0x71, "LD", 1, "[8]", "x8/lsm")),
        0x72 => Some(to_string(0x72, "LD", 1, "[8]", "x8/lsm")),
        0x73 => Some(to_string(0x73, "LD", 1, "[8]", "x8/lsm")),
        0x74 => Some(to_string(0x74, "LD", 1, "[8]", "x8/lsm")),
        0x75 => Some(to_string(0x75, "LD", 1, "[8]", "x8/lsm")),
        0x76 => Some(to_string(0x76, "HALT", 1, "[4]", "control/misc")),
        0x77 => Some(to_string(0x77, "LD", 1, "[8]", "x8/lsm")),
        0x78 => Some(to_string(0x78, "LD", 1, "[4]", "x8/lsm")),
        0x79 => Some(to_string(0x79, "LD", 1, "[4]", "x8/lsm")),
        0x7a => Some(to_string(0x7a, "LD", 1, "[4]", "x8/lsm")),
        0x7b => Some(to_string(0x7b, "LD", 1, "[4]", "x8/lsm")),
        0x7c => Some(to_string(0x7c, "LD", 1, "[4]", "x8/lsm")),
        0x7d => Some(to_string(0x7d, "LD", 1, "[4]", "x8/lsm")),
        0x7e => Some(to_string(0x7e, "LD", 1, "[8]", "x8/lsm")),
        0x7f => Some(to_string(0x7f, "LD", 1, "[4]", "x8/lsm")),
        0x80 => Some(to_string(0x80, "ADD", 1, "[4]", "x8/alu")),
        0x81 => Some(to_string(0x81, "ADD", 1, "[4]", "x8/alu")),
        0x82 => Some(to_string(0x82, "ADD", 1, "[4]", "x8/alu")),
        0x83 => Some(to_string(0x83, "ADD", 1, "[4]", "x8/alu")),
        0x84 => Some(to_string(0x84, "ADD", 1, "[4]", "x8/alu")),
        0x85 => Some(to_string(0x85, "ADD", 1, "[4]", "x8/alu")),
        0x86 => Some(to_string(0x86, "ADD", 1, "[8]", "x8/alu")),
        0x87 => Some(to_string(0x87, "ADD", 1, "[4]", "x8/alu")),
        0x88 => Some(to_string(0x88, "ADC", 1, "[4]", "x8/alu")),
        0x89 => Some(to_string(0x89, "ADC", 1, "[4]", "x8/alu")),
        0x8a => Some(to_string(0x8a, "ADC", 1, "[4]", "x8/alu")),
        0x8b => Some(to_string(0x8b, "ADC", 1, "[4]", "x8/alu")),
        0x8c => Some(to_string(0x8c, "ADC", 1, "[4]", "x8/alu")),
        0x8d => Some(to_string(0x8d, "ADC", 1, "[4]", "x8/alu")),
        0x8e => Some(to_string(0x8e, "ADC", 1, "[8]", "x8/alu")),
        0x8f => Some(to_string(0x8f, "ADC", 1, "[4]", "x8/alu")),
        0x90 => Some(to_string(0x90, "SUB", 1, "[4]", "x8/alu")),
        0x91 => Some(to_string(0x91, "SUB", 1, "[4]", "x8/alu")),
        0x92 => Some(to_string(0x92, "SUB", 1, "[4]", "x8/alu")),
        0x93 => Some(to_string(0x93, "SUB", 1, "[4]", "x8/alu")),
        0x94 => Some(to_string(0x94, "SUB", 1, "[4]", "x8/alu")),
        0x95 => Some(to_string(0x95, "SUB", 1, "[4]", "x8/alu")),
        0x96 => Some(to_string(0x96, "SUB", 1, "[8]", "x8/alu")),
        0x97 => Some(to_string(0x97, "SUB", 1, "[4]", "x8/alu")),
        0x98 => Some(to_string(0x98, "SBC", 1, "[4]", "x8/alu")),
        0x99 => Some(to_string(0x99, "SBC", 1, "[4]", "x8/alu")),
        0x9a => Some(to_string(0x9a, "SBC", 1, "[4]", "x8/alu")),
        0x9b => Some(to_string(0x9b, "SBC", 1, "[4]", "x8/alu")),
        0x9c => Some(to_string(0x9c, "SBC", 1, "[4]", "x8/alu")),
        0x9d => Some(to_string(0x9d, "SBC", 1, "[4]", "x8/alu")),
        0x9e => Some(to_string(0x9e, "SBC", 1, "[8]", "x8/alu")),
        0x9f => Some(to_string(0x9f, "SBC", 1, "[4]", "x8/alu")),
        0xa0 => Some(to_string(0xa0, "AND", 1, "[4]", "x8/alu")),
        0xa1 => Some(to_string(0xa1, "AND", 1, "[4]", "x8/alu")),
        0xa2 => Some(to_string(0xa2, "AND", 1, "[4]", "x8/alu")),
        0xa3 => Some(to_string(0xa3, "AND", 1, "[4]", "x8/alu")),
        0xa4 => Some(to_string(0xa4, "AND", 1, "[4]", "x8/alu")),
        0xa5 => Some(to_string(0xa5, "AND", 1, "[4]", "x8/alu")),
        0xa6 => Some(to_string(0xa6, "AND", 1, "[8]", "x8/alu")),
        0xa7 => Some(to_string(0xa7, "AND", 1, "[4]", "x8/alu")),
        0xa8 => Some(to_string(0xa8, "XOR", 1, "[4]", "x8/alu")),
        0xa9 => Some(to_string(0xa9, "XOR", 1, "[4]", "x8/alu")),
        0xaa => Some(to_string(0xaa, "XOR", 1, "[4]", "x8/alu")),
        0xab => Some(to_string(0xab, "XOR", 1, "[4]", "x8/alu")),
        0xac => Some(to_string(0xac, "XOR", 1, "[4]", "x8/alu")),
        0xad => Some(to_string(0xad, "XOR", 1, "[4]", "x8/alu")),
        0xae => Some(to_string(0xae, "XOR", 1, "[8]", "x8/alu")),
        0xaf => Some(to_string(0xaf, "XOR", 1, "[4]", "x8/alu")),
        0xb0 => Some(to_string(0xb0, "OR", 1, "[4]", "x8/alu")),
        0xb1 => Some(to_string(0xb1, "OR", 1, "[4]", "x8/alu")),
        0xb2 => Some(to_string(0xb2, "OR", 1, "[4]", "x8/alu")),
        0xb3 => Some(to_string(0xb3, "OR", 1, "[4]", "x8/alu")),
        0xb4 => Some(to_string(0xb4, "OR", 1, "[4]", "x8/alu")),
        0xb5 => Some(to_string(0xb5, "OR", 1, "[4]", "x8/alu")),
        0xb6 => Some(to_string(0xb6, "OR", 1, "[8]", "x8/alu")),
        0xb7 => Some(to_string(0xb7, "OR", 1, "[4]", "x8/alu")),
        0xb8 => Some(to_string(0xb8, "CP", 1, "[4]", "x8/alu")),
        0xb9 => Some(to_string(0xb9, "CP", 1, "[4]", "x8/alu")),
        0xba => Some(to_string(0xba, "CP", 1, "[4]", "x8/alu")),
        0xbb => Some(to_string(0xbb, "CP", 1, "[4]", "x8/alu")),
        0xbc => Some(to_string(0xbc, "CP", 1, "[4]", "x8/alu")),
        0xbd => Some(to_string(0xbd, "CP", 1, "[4]", "x8/alu")),
        0xbe => Some(to_string(0xbe, "CP", 1, "[8]", "x8/alu")),
        0xbf => Some(to_string(0xbf, "CP", 1, "[4]", "x8/alu")),
        0xc0 => Some(to_string(0xc0, "RET", 1, "[20, 8]", "control/br")),
        0xc1 => Some(to_string(0xc1, "POP", 1, "[12]", "x16/lsm")),
        0xc2 => Some(to_string(0xc2, "JP", 3, "[16, 12]", "control/br")),
        0xc3 => Some(to_string(0xc3, "JP", 3, "[16]", "control/br")),
        0xc4 => Some(to_string(0xc4, "CALL", 3, "[24, 12]", "control/br")),
        0xc5 => Some(to_string(0xc5, "PUSH", 1, "[16]", "x16/lsm")),
        0xc6 => Some(to_string(0xc6, "ADD", 2, "[8]", "x8/alu")),
        0xc7 => Some(to_string(0xc7, "RST", 1, "[16]", "control/br")),
        0xc8 => Some(to_string(0xc8, "RET", 1, "[20, 8]", "control/br")),
        0xc9 => Some(to_string(0xc9, "RET", 1, "[16]", "control/br")),
        0xca => Some(to_string(0xca, "JP", 3, "[16, 12]", "control/br")),
        0xcb => Some(to_string(0xcb, "PREFIX", 1, "[4]", "control/misc")),
        0xcc => Some(to_string(0xcc, "CALL", 3, "[24, 12]", "control/br")),
        0xcd => Some(to_string(0xcd, "CALL", 3, "[24]", "control/br")),
        0xce => Some(to_string(0xce, "ADC", 2, "[8]", "x8/alu")),
        0xcf => Some(to_string(0xcf, "RST", 1, "[16]", "control/br")),
        0xd0 => Some(to_string(0xd0, "RET", 1, "[20, 8]", "control/br")),
        0xd1 => Some(to_string(0xd1, "POP", 1, "[12]", "x16/lsm")),
        0xd2 => Some(to_string(0xd2, "JP", 3, "[16, 12]", "control/br")),
        0xd4 => Some(to_string(0xd4, "CALL", 3, "[24, 12]", "control/br")),
        0xd5 => Some(to_string(0xd5, "PUSH", 1, "[16]", "x16/lsm")),
        0xd6 => Some(to_string(0xd6, "SUB", 2, "[8]", "x8/alu")),
        0xd7 => Some(to_string(0xd7, "RST", 1, "[16]", "control/br")),
        0xd8 => Some(to_string(0xd8, "RET", 1, "[20, 8]", "control/br")),
        0xd9 => Some(to_string(0xd9, "RETI", 1, "[16]", "control/br")),
        0xda => Some(to_string(0xda, "JP", 3, "[16, 12]", "control/br")),
        0xdc => Some(to_string(0xdc, "CALL", 3, "[24, 12]", "control/br")),
        0xde => Some(to_string(0xde, "SBC", 2, "[8]", "x8/alu")),
        0xdf => Some(to_string(0xdf, "RST", 1, "[16]", "control/br")),
        0xe0 => Some(to_string(0xe0, "LDH", 2, "[12]", "x8/lsm")),
        0xe1 => Some(to_string(0xe1, "POP", 1, "[12]", "x16/lsm")),
        0xe2 => Some(to_string(0xe2, "LD", 1, "[8]", "x8/lsm")),
        0xe5 => Some(to_string(0xe5, "PUSH", 1, "[16]", "x16/lsm")),
        0xe6 => Some(to_string(0xe6, "AND", 2, "[8]", "x8/alu")),
        0xe7 => Some(to_string(0xe7, "RST", 1, "[16]", "control/br")),
        0xe8 => Some(to_string(0xe8, "ADD", 2, "[16]", "x16/alu")),
        0xe9 => Some(to_string(0xe9, "JP", 1, "[4]", "control/br")),
        0xea => Some(to_string(0xea, "LD", 3, "[16]", "x8/lsm")),
        0xee => Some(to_string(0xee, "XOR", 2, "[8]", "x8/alu")),
        0xef => Some(to_string(0xef, "RST", 1, "[16]", "control/br")),
        0xf0 => Some(to_string(0xf0, "LDH", 2, "[12]", "x8/lsm")),
        0xf1 => Some(to_string(0xf1, "POP", 1, "[12]", "x16/lsm")),
        0xf2 => Some(to_string(0xf2, "LD", 1, "[8]", "x8/lsm")),
        0xf3 => Some(to_string(0xf3, "DI", 1, "[4]", "control/misc")),
        0xf5 => Some(to_string(0xf5, "PUSH", 1, "[16]", "x16/lsm")),
        0xf6 => Some(to_string(0xf6, "OR", 2, "[8]", "x8/alu")),
        0xf7 => Some(to_string(0xf7, "RST", 1, "[16]", "control/br")),
        0xf8 => Some(to_string(0xf8, "LD", 2, "[12]", "x16/lsm")),
        0xf9 => Some(to_string(0xf9, "LD", 1, "[8]", "x16/lsm")),
        0xfa => Some(to_string(0xfa, "LD", 3, "[16]", "x8/lsm")),
        0xfb => Some(to_string(0xfb, "EI", 1, "[4]", "control/misc")),
        0xfe => Some(to_string(0xfe, "CP", 2, "[8]", "x8/alu")),
        0xff => Some(to_string(0xff, "RST", 1, "[16]", "control/br")),
        _ => None
    }
}
